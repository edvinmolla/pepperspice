{% extends "html/spec-comp/dashboard/index.html" %}
{% block content %}

<div class="main-content">

  <div class="ui one column grid m-4">
    <div class="sixteen wide column">




<div class="ui three top attached steps" style="margin-bottom: 20px;">
  <div class="step">
    <i class="upload cloud icon"></i>
    <div class="content">
      <div class="title">Upload</div>
      <div class="description">Upload a Database file or Web Application Project</div>
    </div>
  </div>
  <div class=" step">
    <i class="linkify icon"></i>
    <div class="content">
      <div class="title">Link</div>
      <div class="description">Link your Project or Database file with a container.</div>
    </div>
  </div>
  <div class=" step">
    <i class="arrow circle up icon"></i>
    <div class="content">
      <div class="title">Deploy</div>
      <div class="description">Let the world see your awesome project.</div>
    </div>
  </div>
</div>

<form method="post" enctype="multipart/form-data" action="http://localhost:8000/dashboard/warehouse/">
        {% csrf_token %}
        <!-- <input type="file" name="file" id="zipfile" accept=".zip,.rar,.7zip,.sql,.tar.gz,.tar" /> -->
        <!-- <button type="submit">Upload</button> -->

  <div class="drop-zone" style="z-index: -5;">



    
   
    <input type="file" name="myfile" class="drop-zone__input" id="zipfile">

    

    <div class="ui  grid">





    <div class="row centered">
      <img src="https://image.flaticon.com/icons/svg/101/101314.svg" width="200px">
    </div>



    <div class="row centered" >
      <h2>Drag and Drop or click to browse</h2>
    </div>


    <div class="row centered" style="margin-top: -30px;">
      <h4>(.zip, .rar, .7zip, .tar.gz, .tar)</h4>
    </div>

    <div class="row centered">
      
      <h2 class="namehere">File to upload: </h2>
    </div>


  </div>


  

</div>


 
<div class="progress" style="height: 5px;">
  <div id="progressbar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>

    </div>


    <div class="sixteen wide column">

    <div class="ui  grid">



      <div class="row centered">

        <button class="ui active button" type="submit" id="submit_btn">
          <i class="cloud upload icon"></i>
          Upload
        </button>



      </div>
  
    </div>
  
     
    </div>

  
  </div>
  

</form>



</div>





<script>

$(".namehere").hide();
  document.querySelectorAll(".drop-zone__input").forEach((inputElement) => {
  const dropZoneElement = inputElement.closest(".drop-zone");

  dropZoneElement.addEventListener("click", (e) => {
    inputElement.click();
  });

  inputElement.addEventListener("change", (e) => {
    if (inputElement.files.length) {
      var one = document.getElementById('zipfile').value.split(':')[1].split('.')[0].split('\\')
      var two = document.getElementById('zipfile').value.split(':')[1].split('\\');
      window.package_name = one[one.length-1];
      var package_type = document.getElementById('zipfile').value.split(':')[1].split('.')[1];
      $(".namehere").append(two[two.length-1]);
      $(".namehere").fadeIn();
  
      // updateThumbnail(dropZoneElement, inputElement.files[0]);
    }
  });

  dropZoneElement.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZoneElement.classList.add("drop-zone--over");
  });

  ["dragleave", "dragend"].forEach((type) => {
    dropZoneElement.addEventListener(type, (e) => {
      dropZoneElement.classList.remove("drop-zone--over");
    });
  });

  dropZoneElement.addEventListener("drop", (e) => {
    e.preventDefault();

    if (e.dataTransfer.files.length) {
      inputElement.files = e.dataTransfer.files;
      updateThumbnail(dropZoneElement, e.dataTransfer.files[0]);
    }

    dropZoneElement.classList.remove("drop-zone--over");
  });
});

/**
 * Updates the thumbnail on a drop zone element.
 *
 * @param {HTMLElement} dropZoneElement
 * @param {File} file
 */
function updateThumbnail(dropZoneElement, file) {
  let thumbnailElement = dropZoneElement.querySelector(".drop-zone__thumb");

  // First time - remove the prompt
  if (dropZoneElement.querySelector(".drop-zone__prompt")) {
    dropZoneElement.querySelector(".drop-zone__prompt").remove();
  }

  // First time - there is no thumbnail element, so lets create it
  if (!thumbnailElement) {
    thumbnailElement = document.createElement("div");
    thumbnailElement.classList.add("drop-zone__thumb");
    dropZoneElement.appendChild(thumbnailElement);
  }

  thumbnailElement.dataset.label = file.name;

  // Show thumbnail for image files
  if (file.type.startsWith("image/")) {
    const reader = new FileReader();

    reader.readAsDataURL(file);
    reader.onload = () => {
      thumbnailElement.style.backgroundImage = `url('${reader.result}')`;
    };
  } else {
    thumbnailElement.style.backgroundImage = null;
  }
}

</script>


<style>
  .drop-zone {
  max-width: 100%;
  
  height: 100%;
  padding: 25px;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-family: "Quicksand", sans-serif;
  font-weight: 500;
  font-size: 20px;
  cursor: pointer;
  color: #cccccc;
  border: 2px dashed #dce0e0;
  border-radius: 10px;
}

.drop-zone--over {
  border-style: solid;
}

.drop-zone__input {
  display: none;
}

.drop-zone__thumb {
  width: 100%;
  height: 100%;
  border-radius: 10px;
  overflow: hidden;
  background-color: #cccccc;
  background-size: cover;
  position: relative;
}

.drop-zone__thumb::after {
  content: attr(data-label);
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 5px 0;
  color: #ffffff;
  background: rgba(0, 0, 0, 0.75);
  font-size: 14px;
  text-align: center;
}

</style>

<script>
  $(document).ready(function() {

    $("#submit_btn").addClass('loading');
    $('#submit_btn').attr('disabled',true);

        $('input:file').change(
            function(){
                if ($(this).val()) {
                    $('#submit_btn').attr('disabled',false);
                    $("#submit_btn").removeClass('loading');
                    // or, as has been pointed out elsewhere:
                    // $('input:submit').removeAttr('disabled'); 
                } 
            }
            );





$('form').on('submit', function(event){

if ($("#zipfile").val()){
  location.reload(); 
}

event.preventDefault();

// $("#zipfile").attr('name', window.package_name);

var formData = new FormData($('form')[0]);
$.ajax({
xhr: function(){
var xhr = new window.XMLHttpRequest();
xhr.upload.addEventListener('progress', function(e){
if (e.lengthComputable){
  console.log('Bytes Loaded: ' + e.loaded);
  console.log('Total Size: ' + e.total);
  console.log('Percentage Uploadeed: ' + (e.loaded / e.total));

  var percent = Math.round((e.loaded / e.total) * 100);

  $('#progressbar').attr('aria-valuenow', percent).css('width', percent + '%');
  
  }
});


return xhr;
},
type : 'POST',
url: 'http://localhost:8000/dashboard/warehouse/',
data: formData,
processData: false,
contentType: false,
success: function(){
  alert('file uploaded');
}


});

});







  // $('#zipfile').on('change', function(evt) {
  //   var mb = 1000000
  //   var file_size = this.files[0].size
  //   console.log((file_size/mb).toPrecision(5) + ' Mb');
  // });
});


</script>



</div>


{% endblock %}