{% extends "html/spec-comp/dashboard/index.html" %}
{% block content %}



<style>
  .hideme {
    visibility: hidden;
  }
  
  
  .myAlert-top{
      position: fixed;
      top: 50px; 
      left:30%;
      width: 50%;
      z-index: 101;
  }
  </style>
  
  
  <div class="myAlert-top alert hideme alert-danger" id="alert">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
<a href="#" class="writehere" style="text-decoration: none;">

</a>
<br/>  
<a href="#" class="writehere2link">
<small class="writehere2"></small>
</a>
  </div>





<div class="main-content">

  <div class="ui one column grid m-4">
    <div class="sixteen wide column">
      <h1 style="font-weight: 1;">Files & Projects</h1>
      <br/>

      {% if db_files %}
      <div class="ui stackable grid">
       
        
     

        {% for app in db_files %}
        

        
        <div class="four wide column">
          <div class="card card-file">
            {% if app.file_type == "zip" %}
            <img src="https://image.apphit.com/image/filetype/zip/zip-logo.png" width="120px" style="margin-top: 10px;">
            {% elif app.file_type == "tar" %}
            <img src="https://image.flaticon.com/icons/png/512/29/29575.png" width="120px" style="margin-top: 10px;">
            {% elif app.file_type == "sql" %}
            <img src="https://icon-library.com/images/sql-icon/sql-icon-14.jpg" width="110px" style="margin-top: 20px;">
            {% endif %}
            <div class="card-body">
              <h5 class="card-title">Name: {{ app.file_name }}</h5>
              <h5 class="card-title">Owner: {{ app.email }}</h5>
              <h6 class="card-title">Type: {{ app.file_type }}</h6>
              <h6 class="card-title">Size: {{ app.file_size }}</h6>
            </div>


         {% if app.linked_to_node_uuid == "" %}

            <div class="ui bottom blue attached animated button" tabindex="0" data-toggle="modal" data-target="#linkmodal">
              <div class="visible content">Not Linked</div>
              <div class="hidden content link-btn" >
                <i class="plus icon"></i>
                Link
                
              </div>
            </div>

        {% else %}
        <div class="ui top right orange attached label">Linked</div>


        {% endif %}

          </div>
        </div>
        {% endfor %}
      </div>

      {% endif %}


      <!--  Modal  -->
      <div class="modal fade" id="linkmodal" tabindex="-1" role="dialog" aria-labelledby="linkmodal" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="myModalLabel">Link Project</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">



              <div class="container mt-4">

                <h1 style="color: black; font-weight: 50; display: inline-block;">Link To An Application</h1>
              
                <div class="row">
              
                  
                  {% for application in applications %}

                  <div class="col-sm-3" onclick="linknode('{{ application.node_ID }}');">

                  <input type="checkbox" name="product" class="card-input-element" />

                  <div class="ui card panel panel-default card-input">
                    
                    <div class="content">
                        <i class="{{ application.Framework }} icon" style="float: right; font-size: 25px; color:orangered;"></i>
                        <a class="header">{{ application.Name }}</a>
                        <br/>
                        <div class="meta">
                          <a class="ui teal label" style="font-size: 10px;">ID: {{ application.node_ID }}</a>
                        
                        </div>
                    
                        <div class="meta" style="margin-top: 5px;">
                          <a class="ui green label" style="font-size: 9px;">{{ application.framework_version }}</a>
                         
                      </div>
                      
                    
                        
                    </div>
                  <!-- extra field here -->
                </div>

                  </div>
              
                
                  {% endfor %}
               
                </div>

               
             

              
                </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>




    
     
<style>


.modal-dialog {
  min-width: 600px;
  width: 600px;
}

.card-file {
  max-width: 250px;
}

.card-input-element {



display: none;
}

.card-input {

border-radius: 5px;
margin: 10px;
padding: 15px;
}

.card-input:hover {
box-shadow: 0 0 1px 1px #2ecc71;
cursor: pointer;
}

.card-input-element:checked + .card-input {
background-color: #a4c5e7;
box-shadow: 0 0 1px 1px #007FFF;
}
 
</style>
     

   



      <br/>
      <br/>
 




<div class="ui three top attached steps" style="margin-bottom: 20px;">
  <div class="step ">
    <i class="upload cloud icon"></i>
    <div class="content ">
      <div class="title">Upload</div>
      <div class="description">Upload a Database file or Web Application Project</div>
    </div>
  </div>
  <div class=" step">
    <i class="linkify icon"></i>
    <div class="content">
      <div class="title">Link</div>
      <div class="description">Link your Project or Database file with a container.</div>
    </div>
  </div>
  <div class=" step">
    <i class="arrow circle up icon"></i>
    <div class="content">
      <div class="title">Deploy</div>
      <div class="description">Let the world see your awesome project.</div>
    </div>
  </div>
</div>

<form method="post" enctype="multipart/form-data" action="#">
        {% csrf_token %}
        <!-- <input type="file" name="file" id="zipfile" accept=".zip,.rar,.7zip,.sql,.tar.gz,.tar" /> -->
        <!-- <button type="submit">Upload</button> -->

  <div class="drop-zone" style="z-index: -5;">



    
   
    <input type="file" name="myfile" class="drop-zone__input" id="zipfile" accept=".zip,.rar,.7zip,.sql,.tar.gz,.tar,.sql">

    

    <div class="ui  grid">





    <div class="row centered" style="margin-top: 30px;">
      <img src="https://image.flaticon.com/icons/svg/101/101314.svg" width="200px">
    </div>



    <div class="row centered" >
      <h2>Drag and Drop or click to browse</h2>
    </div>


    <div class="row centered" style="margin-top: -30px;">
      <h4>(.zip, .rar, .7zip, .tar.gz, .tar)</h4>
    </div>


    <div class="row centered">
      <h2 class="namehere"></h2>
    </div>


  </div>


  

</div>



<div class="progress" style="height: 5px;">
  <div id="progressbar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>

    </div>


    <div class="sixteen wide column">

    <div class="ui  grid">



      <div class="row centered">

        <button class="ui green loading button disabled" type="submit" id="submit_btn" >
          <i class="cloud upload icon"></i>
          Upload
        </button>



      </div>
  
    </div>
  
     
    </div>

  
  </div>
  

</form>



</div>





<script>
$(".namehere").hide();
  document.querySelectorAll(".drop-zone__input").forEach((inputElement) => {
  const dropZoneElement = inputElement.closest(".drop-zone");

  dropZoneElement.addEventListener("click", (e) => {
    inputElement.click();
  });

  inputElement.addEventListener("change", (e) => {
    if (inputElement.files.length) {
      var one = document.getElementById('zipfile').value.split(':')[1].split('.')[0].split('\\')
      var two = document.getElementById('zipfile').value.split(':')[1].split('\\');
      window.package_name = one[one.length-1];
      window.package_type = document.getElementById('zipfile').value.split(':')[1].split('.')[1];
      $(".namehere").text(two[two.length-1]);
      $(".namehere").fadeIn();

    }
  });

  dropZoneElement.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZoneElement.classList.add("drop-zone--over");
  });

  ["dragleave", "dragend"].forEach((type) => {
    dropZoneElement.addEventListener(type, (e) => {
      dropZoneElement.classList.remove("drop-zone--over");
    });
  });

  dropZoneElement.addEventListener("drop", (e) => {
    e.preventDefault();

    if (e.dataTransfer.files.length) {
      inputElement.files = e.dataTransfer.files;
      updateThumbnail(dropZoneElement, e.dataTransfer.files[0]);
    }

    dropZoneElement.classList.remove("drop-zone--over");
  });
});

/**
 * Updates the thumbnail on a drop zone element.
 *
 * @param {HTMLElement} dropZoneElement
 * @param {File} file
 */
function updateThumbnail(dropZoneElement, file) {
  let thumbnailElement = dropZoneElement.querySelector(".drop-zone__thumb");

  // First time - remove the prompt
  if (dropZoneElement.querySelector(".drop-zone__prompt")) {
    dropZoneElement.querySelector(".drop-zone__prompt").remove();
  }

  // First time - there is no thumbnail element, so lets create it
  if (!thumbnailElement) {
    thumbnailElement = document.createElement("div");
    thumbnailElement.classList.add("drop-zone__thumb");
    dropZoneElement.appendChild(thumbnailElement);
  }

  thumbnailElement.dataset.label = file.name;

  // Show thumbnail for image files
  if (file.type.startsWith("image/")) {
    const reader = new FileReader();

    reader.readAsDataURL(file);
    reader.onload = () => {
      thumbnailElement.style.backgroundImage = `url('${reader.result}')`;
    };
  } else {
    thumbnailElement.style.backgroundImage = null;
  }
}

</script>


<style>
  .drop-zone {
  max-width: 100%;
  
  height: 100%;
  padding: 25px;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-family: "Quicksand", sans-serif;
  font-weight: 500;
  font-size: 20px;
  cursor: pointer;
  color: #cccccc;
  border: 2px dashed #dce0e0;
  border-radius: 10px;
}

.drop-zone--over {
  border-style: solid;
}

.drop-zone__input {
  display: none;
}

.drop-zone__thumb {
  width: 100%;
  height: 100%;
  border-radius: 10px;
  overflow: hidden;
  background-color: #cccccc;
  background-size: cover;
  position: relative;
}

.drop-zone__thumb::after {
  content: attr(data-label);
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 5px 0;
  color: #ffffff;
  background: rgba(0, 0, 0, 0.75);
  font-size: 14px;
  text-align: center;
}

</style>

<script>
  $(document).ready(function() {
    $(".progress").hide();
    document.getElementById("submit_btn").style='opacity: 1 !important';
    $("#submit_btn").addClass('loading');


        $('input:file').change(
            function(){
                if ($(this).val()) {
                  $("#submit_btn").removeClass('disabled');
                    $("#submit_btn").removeClass('loading');
                    // or, as has been pointed out elsewhere:
                    // $('input:submit').removeAttr('disabled'); 
                } 
            }
            );



accepted_types = ['zip', '7zip', 'rar', 'tar.gz', 'tar', 'sql'];

$('form').on('submit', function(event){


if (!$("#zipfile").val()){
  location.reload(); 
}

if (accepted_types.includes(window.package_type) == false){
  $('#alert').removeClass('hideme');
    $( ".writehere" ).html( 'That file type Is not supported.' );
  return false;
}

else {
  $('#alert').fadeOut;
  
}

event.preventDefault();

$(".progress").fadeIn();

var formData = new FormData($('form')[0]);
$.ajax({
xhr: function(){
var xhr = new window.XMLHttpRequest();
xhr.upload.addEventListener('progress', function(e){
if (e.lengthComputable){
  // console.log('Bytes Loaded: ' + e.loaded);
  // console.log('Total Size: ' + e.total);
  // console.log('Percentage Uploadeed: ' + (e.loaded / e.total));

  var percent = Math.round((e.loaded / e.total) * 100);

  $('#progressbar').attr('aria-valuenow', percent).css('width', percent + '%');
  
  }

 
});


return xhr;

},
type : 'POST',
url: 'http://localhost:8000/dashboard/warehouse/',
data: formData,
processData: false,
contentType: false,
success: function(data1){
  
if (data1 == 'false'){
  $('#alert').removeClass('hideme');
    $( ".writehere" ).html( 'That file type Is not supported.' );
}
else if (data1 == 'true'){
  $('#alert').addClass('hideme');
  location.reload();
}
}
});

});







  // $('#zipfile').on('change', function(evt) {
  //   var mb = 1000000
  //   var file_size = this.files[0].size
  //   console.log((file_size/mb).toPrecision(5) + ' Mb');
  // });
});


</script>



</div>


{% endblock %}